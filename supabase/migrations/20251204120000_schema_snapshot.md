# Supabase Schema Snapshot - December 4, 2025

## Current Database State

This snapshot was taken after applying the `create_panel_edges` migration.

### Tables

1. **profiles** - User profile information
2. **usage** - Daily usage tracking for rate limiting
3. **conversations** - User conversations/threads
4. **subscriptions** - Stripe subscription management
5. **messages** - Messages within conversations
6. **embeddings** - Vector embeddings for semantic search
7. **panel_edges** - NEW: Connections between panels (edges/lines)

### New Table: panel_edges

**Purpose**: Store connections (edges/lines) between panels in conversations with minimal data for fast loading.

**Columns**:
- `id` (UUID, Primary Key) - Unique identifier
- `conversation_id` (UUID, FK to conversations) - Conversation reference
- `user_id` (UUID, FK to auth.users) - User reference
- `source_message_id` (UUID, FK to messages) - Source panel's message ID
- `target_message_id` (UUID, FK to messages) - Target panel's message ID
- `created_at` (TIMESTAMPTZ) - Creation timestamp

**Constraints**:
- UNIQUE constraint on `(source_message_id, target_message_id)` to prevent duplicate edges
- CASCADE DELETE on conversation_id, user_id, and message_id references

**Indexes**:
- `idx_panel_edges_conversation_id` - Fast lookups by conversation
- `idx_panel_edges_user_id` - RLS performance optimization

**Row Level Security (RLS)**:
- Enabled with policies for SELECT, INSERT, and DELETE
- Users can only access their own edges

**Design Rationale**:
- Lightweight: Only stores message IDs, not full edge data
- Fast queries: Indexed on conversation_id for quick loading
- Efficient: Minimal data transfer and storage
- Persistent: Edges survive page refreshes and browser restarts





